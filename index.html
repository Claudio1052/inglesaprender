<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VoiceLearn Pro - Clone sua Voz para Aprender Inglês</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.2/axios.min.js"></script>
    <style>
        :root {
            --primary: #4f46e5;
            --primary-dark: #3730a3;
            --secondary: #7c3aed;
            --accent: #10b981;
            --light: #f8fafc;
            --dark: #1e293b;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --gray: #64748b;
            --border-radius: 12px;
            --box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            font-family: 'Segoe UI', 'Inter', sans-serif; 
        }
        
        body { 
            background: linear-gradient(135deg, #f0f9ff 0%, #f8fafc 100%);
            color: var(--dark); 
            min-height: 100vh;
            line-height: 1.6;
        }

        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 0 20px; 
        }

        /* Header */
        header {
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .logo i {
            color: var(--secondary);
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 5px;
        }

        .nav-link {
            padding: 10px 20px;
            text-decoration: none;
            color: var(--gray);
            border-radius: 30px;
            transition: var(--transition);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-link:hover,
        .nav-link.active {
            background: var(--primary);
            color: white;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 16px;
            background: var(--light);
            border-radius: 30px;
        }

        .avatar {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* Main Content */
        main {
            padding: 40px 0;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cards */
        .card {
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--box-shadow);
            margin-bottom: 30px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(79, 70, 229, 0.3);
        }

        .btn-secondary {
            background: white;
            color: var(--dark);
            border: 2px solid #e2e8f0;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #f8fafc;
            border-color: var(--primary);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: var(--transition);
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        /* Recording */
        .recording-circle {
            width: 100px;
            height: 100px;
            background: white;
            border: 3px solid #e2e8f0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px auto;
            cursor: pointer;
            transition: var(--transition);
        }

        .recording-circle:hover {
            border-color: var(--primary);
            transform: scale(1.05);
        }

        .recording-circle.recording {
            border-color: var(--danger);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
            70% { box-shadow: 0 0 0 15px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }

        /* Lessons */
        .lesson-container {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 30px;
        }

        @media (max-width: 768px) {
            .lesson-container {
                grid-template-columns: 1fr;
            }
        }

        .lesson-content {
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--box-shadow);
        }

        .lesson-sidebar {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
            height: fit-content;
        }

        .phrase-display {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            padding: 30px;
            border-radius: var(--border-radius);
            margin: 20px 0;
            text-align: center;
        }

        .english-phrase {
            font-size: 2rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 10px;
        }

        .translation {
            font-size: 1.2rem;
            color: var(--gray);
        }

        /* Admin */
        .admin-container {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 30px;
        }

        @media (max-width: 768px) {
            .admin-container {
                grid-template-columns: 1fr;
            }
        }

        .admin-sidebar {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
        }

        .admin-nav {
            list-style: none;
        }

        .admin-nav li {
            margin-bottom: 5px;
        }

        .admin-nav a {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 15px;
            text-decoration: none;
            color: var(--gray);
            border-radius: 8px;
            transition: var(--transition);
        }

        .admin-nav a:hover,
        .admin-nav a.active {
            background: var(--primary);
            color: white;
        }

        .admin-content {
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--box-shadow);
        }

        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin: 10px 0;
        }

        /* Progress */
        .progress-bar {
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 0%;
            transition: width 0.5s ease;
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 10000;
            transform: translateX(150%);
            transition: transform 0.3s ease;
            border-left: 4px solid var(--primary);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-left-color: var(--success);
        }

        .notification.error {
            border-left-color: var(--danger);
        }

        .notification.warning {
            border-left-color: var(--warning);
        }

        /* Loading */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #e2e8f0;
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Audio Player */
        audio {
            width: 100%;
            margin: 20px 0;
            border-radius: 8px;
        }

        /* Lesson List */
        .lesson-list {
            list-style: none;
        }

        .lesson-item {
            padding: 15px;
            border-bottom: 1px solid #e2e8f0;
            cursor: pointer;
            transition: var(--transition);
            border-radius: 8px;
            margin-bottom: 5px;
        }

        .lesson-item:hover {
            background: #f8fafc;
        }

        .lesson-item.active {
            background: var(--primary);
            color: white;
        }

        /* Difficulty Badges */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .badge-beginner {
            background: #dcfce7;
            color: #166534;
        }

        .badge-intermediate {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-advanced {
            background: #fee2e2;
            color: #991b1b;
        }

        /* Category Tags */
        .category-tag {
            display: inline-block;
            padding: 4px 12px;
            background: #e0e7ff;
            color: var(--primary);
            border-radius: 20px;
            font-size: 0.85rem;
            margin: 2px;
        }

        /* Recording Steps */
        .recording-steps {
            display: flex;
            justify-content: space-between;
            margin: 30px 0;
            position: relative;
        }

        .recording-steps::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 2px;
            background: #e2e8f0;
            z-index: 1;
        }

        .recording-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 2;
        }

        .step-number {
            width: 40px;
            height: 40px;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 10px;
            transition: var(--transition);
        }

        .recording-step.active .step-number {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .recording-step.completed .step-number {
            background: var(--success);
            color: white;
            border-color: var(--success);
        }

        /* Recording Phrase Card */
        .recording-phrase-card {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: var(--border-radius);
            padding: 25px;
            margin: 20px 0;
            text-align: center;
        }

        .recording-phrase-card.recording {
            border-color: var(--primary);
            background: #f0f9ff;
        }

        /* Voice Clone Status */
        .clone-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .clone-status.creating {
            background: #fef3c7;
            color: #92400e;
        }

        .clone-status.ready {
            background: #dcfce7;
            color: #166534;
        }

        .clone-status.error {
            background: #fee2e2;
            color: #991b1b;
        }
    </style>
</head>
<body>
    <!-- Notification System -->
    <div id="notification" class="notification">
        <i id="notification-icon" class="fas fa-info-circle"></i>
        <div>
            <div id="notification-title" style="font-weight: bold;"></div>
            <div id="notification-message" style="font-size: 0.9rem; color: var(--gray);"></div>
        </div>
        <button onclick="VoiceLearn.hideNotification()" style="background: none; border: none; color: var(--gray); cursor: pointer;">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-user-circle"></i>
                    <span>VoiceLearn Pro - Clone sua Voz</span>
                </div>
                <nav>
                    <ul>
                        <li><a href="#" class="nav-link active" onclick="VoiceLearn.navigate('home')">
                            <i class="fas fa-home"></i> Início
                        </a></li>
                        <li><a href="#" class="nav-link" onclick="VoiceLearn.navigate('clone')">
                            <i class="fas fa-microphone-alt"></i> Clonar Voz
                        </a></li>
                        <li><a href="#" class="nav-link" onclick="VoiceLearn.navigate('lessons')">
                            <i class="fas fa-graduation-cap"></i> Aulas
                        </a></li>
                        <li><a href="#" class="nav-link" onclick="VoiceLearn.navigate('practice')">
                            <i class="fas fa-headphones"></i> Praticar
                        </a></li>
                        <li><a href="#" class="nav-link" onclick="VoiceLearn.navigate('admin')">
                            <i class="fas fa-crown"></i> Admin
                        </a></li>
                    </ul>
                </nav>
                <div class="user-info">
                    <div class="avatar" id="userAvatar">U</div>
                    <span id="userName">Usuário</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container">
        <!-- Home Page -->
        <section id="home-page" class="page active">
            <div class="card">
                <h1 style="margin-bottom: 20px; color: var(--primary);">
                    <i class="fas fa-user-circle"></i> Aprenda Inglês com SUA Voz
                </h1>
                <p style="margin-bottom: 20px; font-size: 1.1rem; color: var(--gray);">
                    Clone sua voz usando IA e aprenda inglês ouvindo você mesmo falar! Tecnologia Resemble.ai.
                </p>
                
                <div id="voiceStatusCard" style="background: #f0f9ff; padding: 20px; border-radius: var(--border-radius); margin-bottom: 30px; border-left: 4px solid var(--primary);">
                    <h4 style="margin-bottom: 10px;">
                        <i class="fas fa-microphone-alt"></i> Status da Sua Voz
                    </h4>
                    <div id="voiceStatusContent">
                        <!-- Dynamic content will be loaded here -->
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <i class="fas fa-book" style="font-size: 2rem; color: var(--primary); margin-bottom: 10px;"></i>
                        <div class="stat-value" id="totalLessons">5</div>
                        <div>Lições Disponíveis</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-check-circle" style="font-size: 2rem; color: var(--success); margin-bottom: 10px;"></i>
                        <div class="stat-value" id="completedLessons">0</div>
                        <div>Lições Concluídas</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-microphone-alt" style="font-size: 2rem; color: var(--secondary); margin-bottom: 10px;"></i>
                        <div class="stat-value" id="clonedPhrases">0</div>
                        <div>Frases Clonadas</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-chart-line" style="font-size: 2rem; color: var(--accent); margin-bottom: 10px;"></i>
                        <div class="stat-value" id="progressPercent">0%</div>
                        <div>Progresso Geral</div>
                    </div>
                </div>

                <div style="margin: 40px 0;">
                    <h2 style="margin-bottom: 20px;">Comece Agora</h2>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="VoiceLearn.navigate('clone')">
                            <i class="fas fa-microphone-alt"></i> Clonar Minha Voz
                        </button>
                        <button class="btn btn-secondary" onclick="VoiceLearn.navigate('lessons')">
                            <i class="fas fa-graduation-cap"></i> Ver Lições
                        </button>
                        <button class="btn btn-success" onclick="VoiceLearn.navigate('practice')">
                            <i class="fas fa-headphones"></i> Praticar Pronúncia
                        </button>
                    </div>
                </div>

                <div style="background: #f8fafc; padding: 20px; border-radius: var(--border-radius); margin-top: 30px; border: 2px dashed #e2e8f0;">
                    <h3 style="margin-bottom: 15px; color: var(--primary);">
                        <i class="fas fa-lightbulb"></i> Como Funciona?
                    </h3>
                    <ol style="color: var(--gray); padding-left: 20px;">
                        <li style="margin-bottom: 10px;"><strong>Grave sua voz</strong> - Fale algumas frases em português</li>
                        <li style="margin-bottom: 10px;"><strong>Clone com IA</strong> - Resemble.ai cria um clone da sua voz</li>
                        <li style="margin-bottom: 10px;"><strong>Aprenda inglês</strong> - Ouça frases em inglês na SUA voz</li>
                        <li><strong>Pratique</strong> - Compare sua pronúncia com o clone</li>
                    </ol>
                </div>
            </div>
        </section>

        <!-- Clone Voice Page -->
        <section id="clone-page" class="page">
            <div class="card">
                <h2 style="margin-bottom: 20px; color: var(--primary);">
                    <i class="fas fa-microphone-alt"></i> Clonar sua Voz com Resemble.ai
                </h2>
                
                <div style="background: linear-gradient(135deg, #f0f9ff, #e0f2fe); padding: 20px; border-radius: var(--border-radius); margin-bottom: 30px;">
                    <h4 style="margin-bottom: 10px;">
                        <i class="fas fa-info-circle"></i> Prepare-se para gravar
                    </h4>
                    <p style="color: var(--dark);">
                        Grave 5 frases em português para criar um clone da sua voz. Fale claramente em um ambiente silencioso.
                    </p>
                </div>

                <div class="form-group">
                    <label>Seu Nome</label>
                    <input type="text" id="userNameInput" placeholder="Digite seu nome" value="Aluno VoiceLearn">
                </div>

                <!-- Recording Steps -->
                <div class="recording-steps">
                    <div class="recording-step active" id="step1">
                        <div class="step-number">1</div>
                        <div style="font-size: 0.9rem; text-align: center;">Configurar</div>
                    </div>
                    <div class="recording-step" id="step2">
                        <div class="step-number">2</div>
                        <div style="font-size: 0.9rem; text-align: center;">Gravar</div>
                    </div>
                    <div class="recording-step" id="step3">
                        <div class="step-number">3</div>
                        <div style="font-size: 0.9rem; text-align: center;">Processar</div>
                    </div>
                    <div class="recording-step" id="step4">
                        <div class="step-number">4</div>
                        <div style="font-size: 0.9rem; text-align: center;">Pronto!</div>
                    </div>
                </div>

                <!-- Step 1: Setup -->
                <div id="step1-content">
                    <div style="text-align: center; padding: 40px 20px;">
                        <div style="width: 100px; height: 100px; background: linear-gradient(135deg, var(--primary), var(--secondary)); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 30px;">
                            <i class="fas fa-microphone-alt" style="font-size: 3rem; color: white;"></i>
                        </div>
                        <h3 style="margin-bottom: 15px;">Preparar para Gravar</h3>
                        <p style="color: var(--gray); margin-bottom: 25px; max-width: 600px; margin-left: auto; margin-right: auto;">
                            Você gravará 5 frases em português. O Resemble.ai usará essas gravações para criar um clone da sua voz que falará inglês.
                        </p>
                        
                        <div style="background: white; padding: 20px; border-radius: var(--border-radius); margin: 30px auto; max-width: 500px; border: 2px solid #e2e8f0;">
                            <h4 style="margin-bottom: 15px; color: var(--primary);">
                                <i class="fas fa-headphones"></i> Dicas para uma boa gravação:
                            </h4>
                            <ul style="text-align: left; color: var(--gray); padding-left: 20px;">
                                <li style="margin-bottom: 8px;">Use um microfone de qualidade (fones de ouvido são ótimos)</li>
                                <li style="margin-bottom: 8px;">Grave em um ambiente silencioso</li>
                                <li style="margin-bottom: 8px;">Fale naturalmente, como em uma conversa</li>
                                <li style="margin-bottom: 8px;">Mantenha uma distância constante do microfone</li>
                                <li>Pronuncie claramente cada palavra</li>
                            </ul>
                        </div>
                        
                        <button class="btn btn-primary" onclick="VoiceLearn.startRecordingProcess()" style="padding: 15px 30px; font-size: 1.1rem;">
                            <i class="fas fa-play-circle"></i> Começar a Gravar
                        </button>
                    </div>
                </div>

                <!-- Step 2: Recording -->
                <div id="step2-content" style="display: none;">
                    <div style="text-align: center;">
                        <h3 style="margin-bottom: 10px;">Gravação <span id="currentRecordingNumber">1</span>/5</h3>
                        <p style="color: var(--gray); margin-bottom: 20px;">Fale a frase abaixo claramente</p>
                        
                        <div class="progress-bar">
                            <div class="progress-fill" id="recordingProgress" style="width: 20%;"></div>
                        </div>
                    </div>

                    <div class="recording-phrase-card" id="recordingCard">
                        <div class="phrase-display">
                            <div class="english-phrase" id="recordingPhrase">
                                Olá, meu nome é [Seu Nome]
                            </div>
                            <div class="translation">
                                Fale naturalmente, como em uma conversa
                            </div>
                        </div>

                        <div style="text-align: center; margin: 30px 0;">
                            <div class="recording-circle" id="recordButton" onclick="VoiceLearn.toggleRecording()">
                                <i class="fas fa-microphone-alt" style="font-size: 2.5rem;"></i>
                            </div>
                            <p id="recordingStatus" style="color: var(--gray); margin-top: 15px; font-size: 1.1rem;">
                                Clique no microfone para começar
                            </p>
                            <div id="recordingTimer" style="font-size: 1.5rem; font-weight: bold; color: var(--danger); display: none; margin-top: 15px;">
                                <i class="fas fa-circle" style="animation: pulse 1s infinite;"></i> 
                                <span id="timerDisplay">00:00</span>
                            </div>
                        </div>

                        <div id="recordingControls" style="display: none; margin-top: 20px;">
                            <div class="btn-group" style="justify-content: center;">
                                <button class="btn btn-secondary" onclick="VoiceLearn.replayRecording()" id="replayBtn">
                                    <i class="fas fa-redo"></i> Ouvir Novamente
                                </button>
                                <button class="btn btn-success" onclick="VoiceLearn.confirmRecording()" id="confirmBtn">
                                    <i class="fas fa-check"></i> Confirmar Gravação
                                </button>
                                <button class="btn btn-danger" onclick="VoiceLearn.redoRecording()" id="redoBtn">
                                    <i class="fas fa-times"></i> Regravar
                                </button>
                            </div>
                        </div>
                    </div>

                    <audio id="playbackAudio" style="display: none;"></audio>
                </div>

                <!-- Step 3: Processing -->
                <div id="step3-content" style="display: none;">
                    <div style="text-align: center; padding: 40px 20px;">
                        <div style="width: 120px; height: 120px; background: linear-gradient(135deg, #f0f9ff, #e0f2fe); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 30px; border: 4px solid var(--primary);">
                            <i class="fas fa-robot" style="font-size: 3.5rem; color: var(--primary);"></i>
                        </div>
                        <h3 style="margin-bottom: 15px;">Criando Clone da sua Voz</h3>
                        <p style="color: var(--gray); margin-bottom: 25px; max-width: 600px; margin-left: auto; margin-right: auto;">
                            Estamos processando suas gravações com Resemble.ai para criar um clone da sua voz. Isso pode levar alguns minutos.
                        </p>
                        
                        <div class="clone-status creating" style="max-width: 500px; margin: 30px auto;">
                            <i class="fas fa-spinner fa-spin"></i>
                            <span id="processingStatus">Enviando gravações para processamento...</span>
                        </div>
                        
                        <div style="max-width: 500px; margin: 0 auto;">
                            <div class="progress-bar">
                                <div class="progress-fill" id="processingProgress" style="width: 10%;"></div>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-top: 10px;">
                                <span style="font-size: 0.9rem; color: var(--gray);">Progresso</span>
                                <span style="font-size: 0.9rem; color: var(--primary); font-weight: bold;" id="processingPercent">10%</span>
                            </div>
                        </div>
                        
                        <div id="processingDetails" style="background: #f8fafc; padding: 20px; border-radius: var(--border-radius); margin-top: 30px; text-align: left; max-width: 500px; margin-left: auto; margin-right: auto;">
                            <h4 style="margin-bottom: 10px; color: var(--primary);">
                                <i class="fas fa-cogs"></i> O que está acontecendo?
                            </h4>
                            <ul style="color: var(--gray); padding-left: 20px;">
                                <li style="margin-bottom: 8px;">Analisando padrões da sua voz</li>
                                <li style="margin-bottom: 8px;">Criando modelo de voz único</li>
                                <li style="margin-bottom: 8px;">Preparando para síntese em inglês</li>
                                <li>Otimizando para pronúncia clara</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Step 4: Complete -->
                <div id="step4-content" style="display: none;">
                    <div style="text-align: center; padding: 40px 20px;">
                        <div style="width: 120px; height: 120px; background: linear-gradient(135deg, var(--success), var(--accent)); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 30px;">
                            <i class="fas fa-check-circle" style="font-size: 4rem; color: white;"></i>
                        </div>
                        <h3 style="margin-bottom: 15px;">Voz Clonada com Sucesso!</h3>
                        <p style="color: var(--gray); margin-bottom: 30px; max-width: 600px; margin-left: auto; margin-right: auto;">
                            Sua voz foi clonada com sucesso! Agora você pode aprender inglês ouvindo você mesmo falar.
                        </p>
                        
                        <div class="clone-status ready" style="max-width: 500px; margin: 30px auto;">
                            <i class="fas fa-check-circle"></i>
                            <span>Clone de voz pronto para uso</span>
                        </div>
                        
                        <div style="background: #f8fafc; padding: 25px; border-radius: var(--border-radius); margin: 30px auto; max-width: 500px; border: 2px solid #e2e8f0;">
                            <h4 style="margin-bottom: 15px; color: var(--primary);">
                                <i class="fas fa-info-circle"></i> Detalhes do Clone
                            </h4>
                            <div style="text-align: left;">
                                <p style="margin-bottom: 10px;"><strong>Nome:</strong> <span id="cloneName">Clone de [Seu Nome]</span></p>
                                <p style="margin-bottom: 10px;"><strong>ID do Clone:</strong> <code id="cloneId">voice_clone_001</code></p>
                                <p style="margin-bottom: 10px;"><strong>Status:</strong> <span style="color: var(--success); font-weight: bold;">Ativo</span></p>
                                <p style="margin-bottom: 10px;"><strong>Frases clonadas:</strong> <span id="clonedCount">5/5</span></p>
                                <p><strong>Data de criação:</strong> <span id="cloneDate">Hoje</span></p>
                            </div>
                        </div>

                        <div style="margin-top: 30px;">
                            <h4 style="margin-bottom: 15px;">Teste seu Clone</h4>
                            <p style="color: var(--gray); margin-bottom: 20px;">
                                Ouça como sua voz clonada fala inglês:
                            </p>
                            <div class="phrase-display" style="margin: 20px auto; max-width: 500px;">
                                <div class="english-phrase" id="testClonePhrase">Hello, this is my cloned voice speaking English</div>
                                <div class="translation">Olá, esta é minha voz clonada falando inglês</div>
                            </div>
                            <div class="btn-group">
                                <button class="btn btn-primary" onclick="VoiceLearn.testCloneVoice()">
                                    <i class="fas fa-volume-up"></i> Ouvir Clone
                                </button>
                                <button class="btn btn-secondary" onclick="VoiceLearn.testAnotherPhrase()">
                                    <i class="fas fa-random"></i> Outra Frase
                                </button>
                            </div>
                        </div>

                        <div class="btn-group" style="margin-top: 40px;">
                            <button class="btn btn-primary" onclick="VoiceLearn.navigate('lessons')">
                                <i class="fas fa-graduation-cap"></i> Começar Aulas
                            </button>
                            <button class="btn btn-success" onclick="VoiceLearn.addMoreRecordings()">
                                <i class="fas fa-microphone-alt"></i> Adicionar Mais Gravações
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Lessons Page -->
        <section id="lessons-page" class="page">
            <div class="lesson-container">
                <div class="lesson-content">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <h2 style="color: var(--primary);">
                            <i class="fas fa-graduation-cap"></i> Aprenda Inglês com SUA Voz
                        </h2>
                        <div id="lessonVoiceStatus" class="clone-status ready" style="padding: 8px 15px;">
                            <i class="fas fa-user-circle"></i>
                            <span>Usando sua voz clonada</span>
                        </div>
                    </div>

                    <div id="currentLesson">
                        <div class="phrase-display">
                            <div class="english-phrase" id="lessonEnglish">
                                Hello, how are you today?
                            </div>
                            <div class="translation" id="lessonPortuguese">
                                Olá, como você está hoje?
                            </div>
                        </div>

                        <div style="background: #e0f2fe; padding: 15px; border-radius: 8px; margin: 20px 0; border-left: 4px solid var(--primary);">
                            <h4><i class="fas fa-user-circle"></i> Esta frase será falada na SUA voz clonada</h4>
                            <p id="lessonTips">Ouça atentamente como sua voz pronuncia o inglês.</p>
                        </div>

                        <div style="text-align: center; margin: 30px 0;">
                            <button class="btn btn-primary" onclick="VoiceLearn.playLessonWithClone()" id="playLessonBtn">
                                <i class="fas fa-user-circle"></i> Ouvir MINHA voz em Inglês
                            </button>
                            <div id="audioLoading" style="display: none; margin-top: 10px;">
                                <div class="loading"></div>
                                <span style="color: var(--gray); margin-left: 10px;">Gerando áudio com seu clone de voz...</span>
                            </div>
                        </div>

                        <div id="lessonAudioContainer" style="display: none;">
                            <h4><i class="fas fa-headphones"></i> Áudio Gerado</h4>
                            <audio id="lessonAudio" controls style="width: 100%; margin: 15px 0;"></audio>
                            <p style="color: var(--gray); font-size: 0.9rem;">
                                <i class="fas fa-info-circle"></i> Esta é SUA voz clonada falando inglês
                            </p>
                        </div>

                        <div style="background: #f8fafc; padding: 20px; border-radius: var(--border-radius); margin-top: 30px;">
                            <h4><i class="fas fa-pencil-alt"></i> Anotações</h4>
                            <textarea id="lessonNotes" placeholder="Anote o que você aprendeu sobre sua pronúncia..." 
                                      style="width: 100%; padding: 15px; border: 2px solid #e2e8f0; border-radius: 8px; margin-top: 10px; min-height: 100px;"></textarea>
                        </div>

                        <div style="display: flex; justify-content: space-between; margin-top: 30px;">
                            <button class="btn btn-secondary" onclick="VoiceLearn.prevLesson()" id="prevLessonBtn">
                                <i class="fas fa-chevron-left"></i> Anterior
                            </button>
                            <div>
                                <span style="color: var(--gray);">Progresso: </span>
                                <span id="lessonProgress" style="color: var(--primary); font-weight: bold;">1/5</span>
                                <button class="btn btn-success" onclick="VoiceLearn.completeLesson()" id="completeLessonBtn" style="margin-left: 20px; padding: 8px 16px;">
                                    <i class="fas fa-check"></i> Concluir
                                </button>
                            </div>
                            <button class="btn btn-primary" onclick="VoiceLearn.nextLesson()" id="nextLessonBtn">
                                Próxima <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="lesson-sidebar">
                    <h3 style="margin-bottom: 20px;">Lista de Lições</h3>
                    <ul class="lesson-list" id="lessonsList">
                        <!-- Lessons will be populated here -->
                    </ul>
                    
                    <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #e2e8f0;">
                        <h4 style="margin-bottom: 10px;">Seu Progresso</h4>
                        <div class="progress-bar">
                            <div class="progress-fill" id="sidebarProgress" style="width: 0%;"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                            <span style="font-size: 0.9rem; color: var(--gray);" id="progressPercentText">0% concluído</span>
                            <span style="font-size: 0.9rem; color: var(--primary); font-weight: bold;" id="completedCount">0/5</span>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; padding-top: 20px; border-top: 2px solid #e2e8f0;">
                        <h4 style="margin-bottom: 10px;">
                            <i class="fas fa-user-circle"></i> Seu Clone de Voz
                        </h4>
                        <div id="cloneInfo" style="color: var(--gray); font-size: 0.9rem;">
                            <p><strong>Status:</strong> <span id="sidebarCloneStatus" style="color: var(--success);">Ativo</span></p>
                            <p><strong>Frases:</strong> <span id="sidebarClonedCount">5 clonadas</span></p>
                            <button class="btn btn-secondary" onclick="VoiceLearn.navigate('clone')" style="margin-top: 10px; padding: 5px 10px; font-size: 0.9rem; width: 100%;">
                                <i class="fas fa-microphone-alt"></i> Melhorar Clone
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Practice Page -->
        <section id="practice-page" class="page">
            <div class="card">
                <h2 style="margin-bottom: 20px; color: var(--primary);">
                    <i class="fas fa-headphones"></i> Pratique com SUA Voz
                </h2>
                
                <div style="background: #e0f2fe; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <p style="color: var(--dark);">
                        <i class="fas fa-user-circle"></i> Grave sua voz e compare com SEU clone falando inglês.
                    </p>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 20px;">
                    <div>
                        <h3 style="margin-bottom: 15px;">
                            <i class="fas fa-microphone-alt"></i> Sua Pronúncia
                        </h3>
                        <div class="phrase-display">
                            <div class="english-phrase" id="practicePhrase">
                                Hello, how are you?
                            </div>
                            <div class="translation">
                                Grave sua pronúncia
                            </div>
                        </div>

                        <div style="text-align: center; margin: 20px 0;">
                            <div class="recording-circle" id="practiceRecordBtn" onclick="VoiceLearn.togglePracticeRecording()">
                                <i class="fas fa-microphone-alt" style="font-size: 2rem;"></i>
                            </div>
                            <p id="practiceStatus" style="color: var(--gray); margin-top: 10px;">
                                Clique para gravar sua voz
                            </p>
                        </div>

                        <div id="practicePreview" style="display: none;">
                            <div style="background: #f0f9ff; padding: 15px; border-radius: 8px; margin: 10px 0;">
                                <p style="color: var(--gray);">
                                    <i class="fas fa-info-circle"></i> Sua gravação está pronta. Compare com seu clone.
                                </p>
                            </div>
                            <audio id="userRecording" controls style="width: 100%; margin: 10px 0;"></audio>
                            <div class="btn-group">
                                <button class="btn btn-secondary" onclick="VoiceLearn.redoPractice()">
                                    <i class="fas fa-redo"></i> Regravar
                                </button>
                                <button class="btn btn-primary" onclick="VoiceLearn.compareWithClone()" id="compareBtn">
                                    <i class="fas fa-user-circle"></i> Comparar com Meu Clone
                                </button>
                            </div>
                        </div>
                    </div>

                    <div>
                        <h3 style="margin-bottom: 15px;">
                            <i class="fas fa-user-circle"></i> SEU Clone (Referência)
                        </h3>
                        <div class="phrase-display">
                            <div class="english-phrase" id="cloneReferencePhrase">
                                Hello, how are you?
                            </div>
                            <div class="translation">
                                SUA voz clonada
                            </div>
                        </div>

                        <div style="text-align: center; margin: 20px 0;">
                            <button class="btn btn-primary" onclick="VoiceLearn.playCloneReference()" id="playCloneBtn">
                                <i class="fas fa-user-circle"></i> Ouvir MEU Clone
                            </button>
                            <div id="cloneLoading" style="display: none; margin-top: 10px;">
                                <div class="loading"></div>
                                <span style="color: var(--gray); margin-left: 10px;">Gerando áudio do seu clone...</span>
                            </div>
                        </div>
                        <audio id="cloneAudio" controls style="width: 100%; margin: 10px 0; display: none;"></audio>

                        <div id="comparisonResult" style="display: none;">
                            <h4><i class="fas fa-chart-bar"></i> Comparação com seu Clone</h4>
                            <div style="background: #f8fafc; padding: 20px; border-radius: var(--border-radius); margin: 15px 0;">
                                <div style="margin-bottom: 15px;">
                                    <div style="display: flex; justify-content: space-between;">
                                        <span>Similaridade com seu clone:</span>
                                        <span id="similarityScore" style="font-weight: bold; color: var(--primary);">85%</span>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill" id="similarityBar" style="width: 85%;"></div>
                                    </div>
                                </div>
                                <div id="cloneFeedback" style="color: var(--gray);">
                                    Sua pronúncia está parecida com seu clone! Continue praticando.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-secondary" onclick="VoiceLearn.nextPracticePhrase()">
                        <i class="fas fa-forward"></i> Próxima Frase
                    </button>
                </div>
            </div>
        </section>

        <!-- Admin Page -->
        <section id="admin-page" class="page">
            <div class="admin-container">
                <div class="admin-sidebar">
                    <h3 style="margin-bottom: 20px; color: var(--primary);">
                        <i class="fas fa-crown"></i> Painel Admin
                    </h3>
                    <ul class="admin-nav" id="adminNav">
                        <li><a href="#" class="active" onclick="VoiceLearn.showAdminSection('dashboard')">
                            <i class="fas fa-tachometer-alt"></i> Dashboard
                        </a></li>
                        <li><a href="#" onclick="VoiceLearn.showAdminSection('cloneManagement')">
                            <i class="fas fa-user-circle"></i> Gerenciar Clones
                        </a></li>
                        <li><a href="#" onclick="VoiceLearn.showAdminSection('lessons')">
                            <i class="fas fa-book"></i> Lições
                        </a></li>
                        <li><a href="#" onclick="VoiceLearn.showAdminSection('create')">
                            <i class="fas fa-plus-circle"></i> Nova Lição
                        </a></li>
                    </ul>
                </div>

                <div class="admin-content">
                    <!-- Dashboard -->
                    <div id="adminDashboard" class="admin-section">
                        <h2 style="margin-bottom: 20px;">Dashboard de Clones de Voz</h2>
                        
                        <div style="background: #f0f9ff; padding: 20px; border-radius: var(--border-radius); margin-bottom: 30px;">
                            <h4 style="margin-bottom: 10px;">
                                <i class="fas fa-bolt"></i> Status Resemble.ai
                            </h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                                <div>
                                    <p><strong>Token API:</strong> oGHRQvmNLSjt8HUSC8sguQtt</p>
                                    <p><strong>Endpoint:</strong> https://f.cluster.resemble.ai/synthesize</p>
                                </div>
                                <div>
                                    <p><strong>Status:</strong> <span id="adminApiStatus" style="color: var(--success); font-weight: bold;">Conectado</span></p>
                                    <p><strong>Clones Ativos:</strong> <span id="activeClonesCount">1</span></p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stats-grid">
                            <div class="stat-card">
                                <i class="fas fa-user-circle" style="font-size: 2rem; color: var(--primary); margin-bottom: 10px;"></i>
                                <div class="stat-value" id="adminCloneCount">1</div>
                                <div>Clone de Voz</div>
                            </div>
                            <div class="stat-card">
                                <i class="fas fa-book" style="font-size: 2rem; color: var(--success); margin-bottom: 10px;"></i>
                                <div class="stat-value" id="adminLessonCount">5</div>
                                <div>Lições Criadas</div>
                            </div>
                            <div class="stat-card">
                                <i class="fas fa-microphone-alt" style="font-size: 2rem; color: var(--secondary); margin-bottom: 10px;"></i>
                                <div class="stat-value" id="adminRecordingCount">5</div>
                                <div>Gravações</div>
                            </div>
                            <div class="stat-card">
                                <i class="fas fa-chart-line" style="font-size: 2rem; color: var(--accent); margin-bottom: 10px;"></i>
                                <div class="stat-value" id="adminProgress">0%</div>
                                <div>Progresso Médio</div>
                            </div>
                        </div>

                        <div style="margin-top: 40px;">
                            <h3 style="margin-bottom: 20px;">Ações Rápidas</h3>
                            <div class="btn-group">
                                <button class="btn btn-primary" onclick="VoiceLearn.showAdminSection('create')">
                                    <i class="fas fa-plus"></i> Nova Lição
                                </button>
                                <button class="btn btn-secondary" onclick="VoiceLearn.testCloneAPI()">
                                    <i class="fas fa-plug"></i> Testar API Clone
                                </button>
                                <button class="btn btn-success" onclick="VoiceLearn.exportCloneData()">
                                    <i class="fas fa-download"></i> Exportar Dados
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Clone Management -->
                    <div id="adminCloneManagement" class="admin-section" style="display: none;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                            <h2>Gerenciar Clones de Voz</h2>
                            <button class="btn btn-primary" onclick="VoiceLearn.createNewClone()">
                                <i class="fas fa-plus"></i> Novo Clone
                            </button>
                        </div>

                        <div id="clonesList">
                            <!-- Clones will be listed here -->
                        </div>
                    </div>

                    <!-- Manage Lessons -->
                    <div id="adminLessons" class="admin-section" style="display: none;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                            <h2>Gerenciar Lições</h2>
                            <button class="btn btn-primary" onclick="VoiceLearn.showAdminSection('create')">
                                <i class="fas fa-plus"></i> Nova Lição
                            </button>
                        </div>

                        <div id="lessonsManagement">
                            <!-- Lessons will be listed here -->
                        </div>
                    </div>

                    <!-- Create Lesson -->
                    <div id="adminCreate" class="admin-section" style="display: none;">
                        <h2 style="margin-bottom: 20px;">Criar Nova Lição</h2>
                        
                        <div class="form-group">
                            <label>Título da Lição *</label>
                            <input type="text" id="lessonTitle" placeholder="Ex: Saudações Básicas">
                        </div>

                        <div class="form-group">
                            <label>Frase em Inglês *</label>
                            <textarea id="lessonEnglishInput" rows="3" placeholder="Digite a frase em inglês (será falada pelo clone)"></textarea>
                        </div>

                        <div class="form-group">
                            <label>Tradução em Português *</label>
                            <textarea id="lessonPortugueseInput" rows="3" placeholder="Digite a tradução"></textarea>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                            <div class="form-group">
                                <label>Categoria</label>
                                <select id="lessonCategory">
                                    <option value="greetings">Saudações</option>
                                    <option value="restaurant">Restaurante</option>
                                    <option value="travel">Viagens</option>
                                    <option value="shopping">Compras</option>
                                    <option value="work">Trabalho</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Dificuldade</label>
                                <select id="lessonDifficulty">
                                    <option value="beginner">Iniciante</option>
                                    <option value="intermediate">Intermediário</option>
                                    <option value="advanced">Avançado</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Dicas de Pronúncia</label>
                            <textarea id="lessonTipsInput" rows="2" placeholder="Dicas para pronúncia correta..."></textarea>
                        </div>

                        <div class="btn-group" style="margin-top: 30px;">
                            <button class="btn btn-primary" onclick="VoiceLearn.saveLesson()">
                                <i class="fas fa-save"></i> Salvar Lição
                            </button>
                            <button class="btn btn-secondary" onclick="VoiceLearn.previewLesson()">
                                <i class="fas fa-eye"></i> Visualizar
                            </button>
                            <button class="btn btn-danger" onclick="VoiceLearn.clearLessonForm()">
                                <i class="fas fa-times"></i> Cancelar
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>
        // ==================== VoiceLearn Clone Voice Application ====================
        const VoiceLearn = {
            // Resemble.ai API Configuration
            resembleConfig: {
                apiKey: 'oGHRQvmNLSjt8HUSC8sguQtt',
                synthesisEndpoint: 'https://f.cluster.resemble.ai/synthesize',
                projectId: 'voice_clone_project',
                voiceCloneId: null,
                apiConnected: true
            },

            // Recording phrases for voice cloning (in Portuguese)
            cloningPhrases: [
                "Olá, meu nome é [Nome]. É um prazer conhecer você.",
                "Eu estou aprendendo inglês com tecnologia de voz.",
                "O clima hoje está muito agradável para estudar.",
                "Gosto de praticar minha pronúncia todos os dias.",
                "Esta tecnologia vai me ajudar a falar inglês melhor."
            ],

            // Practice phrases in English
            practicePhrases: [
                "Hello, how are you today?",
                "Thank you very much for your help.",
                "Where is the nearest restaurant?",
                "I would like to order a coffee, please.",
                "How much does this cost in dollars?"
            ],

            // Application State
            state: {
                user: {
                    name: 'Aluno VoiceLearn',
                    voiceCloned: false,
                    voiceCloneId: null,
                    recordings: [],
                    recordingsComplete: false
                },
                lessons: [
                    {
                        id: 1,
                        title: 'Saudações Básicas',
                        english: 'Hello, how are you today?',
                        portuguese: 'Olá, como você está hoje?',
                        category: 'greetings',
                        difficulty: 'beginner',
                        tips: 'Ouça como sua voz pronuncia "how are you"',
                        completed: false,
                        notes: ''
                    },
                    {
                        id: 2,
                        title: 'Apresentação',
                        english: 'My name is [Name], nice to meet you.',
                        portuguese: 'Meu nome é [Nome], prazer em conhecê-lo.',
                        category: 'greetings',
                        difficulty: 'beginner',
                        tips: 'Preste atenção na pronúncia de "nice to meet you"',
                        completed: false,
                        notes: ''
                    },
                    {
                        id: 3,
                        title: 'Origem',
                        english: 'I am from Brazil, and you?',
                        portuguese: 'Eu sou do Brasil, e você?',
                        category: 'greetings',
                        difficulty: 'beginner',
                        tips: 'Note como sua voz fala "Brazil" em inglês',
                        completed: false,
                        notes: ''
                    },
                    {
                        id: 4,
                        title: 'Gostos Pessoais',
                        english: 'I like to learn new languages.',
                        portuguese: 'Eu gosto de aprender novos idiomas.',
                        category: 'personal',
                        difficulty: 'intermediate',
                        tips: 'Observe a pronúncia de "languages"',
                        completed: false,
                        notes: ''
                    },
                    {
                        id: 5,
                        title: 'Pedidos',
                        english: 'Could you speak slower, please?',
                        portuguese: 'Você poderia falar mais devagar, por favor?',
                        category: 'requests',
                        difficulty: 'intermediate',
                        tips: 'Preste atenção no "slower"',
                        completed: false,
                        notes: ''
                    }
                ],
                currentLesson: 0,
                completedLessons: [],
                currentPractice: 0,
                currentRecording: 0,
                recordings: [],
                cloneStatus: 'not_started', // not_started, recording, processing, ready
                cloneProgress: 0
            },

            // Audio Recording Variables
            mediaRecorder: null,
            audioStream: null,
            audioChunks: [],
            isRecording: false,
            recordingTimer: null,
            recordingStartTime: null,
            currentAudioUrl: null,

            // Initialize Application
            init: function() {
                this.loadState();
                this.updateUserInfo();
                this.renderLessonsList();
                this.updateStats();
                this.updateVoiceStatus();
                
                this.showNotification('Bem-vindo ao VoiceLearn Clone!', 'Clone sua voz e aprenda inglês com você mesmo.', 'success');
            },

            // Update Voice Status Display
            updateVoiceStatus: function() {
                const voiceStatusContent = document.getElementById('voiceStatusContent');
                const sidebarCloneStatus = document.getElementById('sidebarCloneStatus');
                const lessonVoiceStatus = document.getElementById('lessonVoiceStatus');
                
                if (!voiceStatusContent) return;
                
                if (this.state.user.voiceCloned && this.state.user.voiceCloneId) {
                    // Voice is cloned
                    voiceStatusContent.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="width: 60px; height: 60px; background: linear-gradient(135deg, var(--success), var(--accent)); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-user-circle" style="font-size: 2rem; color: white;"></i>
                            </div>
                            <div>
                                <h5 style="margin-bottom: 5px;">Voz Clonada ✓</h5>
                                <p style="color: var(--gray); font-size: 0.9rem;">Sua voz está pronta para ensinar inglês!</p>
                                <p style="color: var(--gray); font-size: 0.8rem; margin-top: 5px;">
                                    <i class="fas fa-microphone-alt"></i> ${this.state.user.recordings.length}/5 frases clonadas
                                </p>
                            </div>
                        </div>
                    `;
                    
                    if (sidebarCloneStatus) {
                        sidebarCloneStatus.textContent = 'Ativo';
                        sidebarCloneStatus.style.color = 'var(--success)';
                    }
                    
                    if (lessonVoiceStatus) {
                        lessonVoiceStatus.className = 'clone-status ready';
                        lessonVoiceStatus.innerHTML = '<i class="fas fa-user-circle"></i> <span>Usando sua voz clonada</span>';
                    }
                    
                } else if (this.state.cloneStatus === 'recording') {
                    // Recording in progress
                    voiceStatusContent.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="width: 60px; height: 60px; background: linear-gradient(135deg, var(--primary), var(--secondary)); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-microphone-alt" style="font-size: 2rem; color: white;"></i>
                            </div>
                            <div>
                                <h5 style="margin-bottom: 5px;">Gravando sua voz...</h5>
                                <p style="color: var(--gray); font-size: 0.9rem;">Progresso: ${this.state.currentRecording + 1}/5 frases</p>
                                <div class="progress-bar" style="margin-top: 10px;">
                                    <div class="progress-fill" style="width: ${(this.state.currentRecording / 5) * 100}%;"></div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                } else if (this.state.cloneStatus === 'processing') {
                    // Processing clone
                    voiceStatusContent.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="width: 60px; height: 60px; background: linear-gradient(135deg, var(--warning), #f59e0b); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-robot" style="font-size: 2rem; color: white;"></i>
                            </div>
                            <div>
                                <h5 style="margin-bottom: 5px;">Processando clone...</h5>
                                <p style="color: var(--gray); font-size: 0.9rem;">Resemble.ai está criando seu clone</p>
                                <div class="progress-bar" style="margin-top: 10px;">
                                    <div class="progress-fill" style="width: ${this.state.cloneProgress}%;"></div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                } else {
                    // Not started
                    voiceStatusContent.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="width: 60px; height: 60px; background: #e2e8f0; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-microphone-slash" style="font-size: 2rem; color: var(--gray);"></i>
                            </div>
                            <div>
                                <h5 style="margin-bottom: 5px;">Voz Não Clonada</h5>
                                <p style="color: var(--gray); font-size: 0.9rem;">Clone sua voz para começar a aprender</p>
                                <button class="btn btn-primary" onclick="VoiceLearn.navigate('clone')" style="margin-top: 10px; padding: 8px 16px; font-size: 0.9rem;">
                                    <i class="fas fa-microphone-alt"></i> Clonar Minha Voz
                                </button>
                            </div>
                        </div>
                    `;
                    
                    if (sidebarCloneStatus) {
                        sidebarCloneStatus.textContent = 'Não clonada';
                        sidebarCloneStatus.style.color = 'var(--danger)';
                    }
                    
                    if (lessonVoiceStatus) {
                        lessonVoiceStatus.className = 'clone-status error';
                        lessonVoiceStatus.innerHTML = '<i class="fas fa-microphone-slash"></i> <span>Voz não clonada</span>';
                    }
                }
                
                // Update cloned phrases count
                document.getElementById('clonedPhrases').textContent = this.state.user.recordings.length;
                document.getElementById('sidebarClonedCount').textContent = `${this.state.user.recordings.length} clonadas`;
            },

            // Navigation
            navigate: function(page) {
                document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                
                document.getElementById(page + '-page').style.display = 'block';
                
                document.querySelectorAll('.nav-link').forEach(link => {
                    if (link.textContent.includes(this.getPageName(page))) {
                        link.classList.add('active');
                    }
                });

                switch(page) {
                    case 'home':
                        this.updateStats();
                        this.updateVoiceStatus();
                        break;
                    case 'clone':
                        this.loadCloningInterface();
                        break;
                    case 'lessons':
                        this.loadLesson(this.state.currentLesson);
                        break;
                    case 'practice':
                        this.loadPracticePhrase();
                        break;
                    case 'admin':
                        this.showAdminSection('dashboard');
                        break;
                }
            },

            getPageName: function(page) {
                const pages = {
                    'home': 'Início',
                    'clone': 'Clonar Voz',
                    'lessons': 'Aulas',
                    'practice': 'Praticar',
                    'admin': 'Admin'
                };
                return pages[page] || page;
            },

            // State Management
            saveState: function() {
                try {
                    localStorage.setItem('voiceLearnCloneState', JSON.stringify(this.state));
                    return true;
                } catch (e) {
                    console.error('Error saving state:', e);
                    return false;
                }
            },

            loadState: function() {
                try {
                    const saved = localStorage.getItem('voiceLearnCloneState');
                    if (saved) {
                        const parsed = JSON.parse(saved);
                        this.state = { ...this.state, ...parsed };
                    }
                } catch (e) {
                    console.error('Error loading state:', e);
                }
            },

            // User Management
            updateUserInfo: function() {
                const userName = this.state.user.name;
                document.getElementById('userName').textContent = userName;
                document.getElementById('userAvatar').textContent = userName.charAt(0).toUpperCase();
                document.getElementById('userNameInput').value = userName;
            },

            // ========== VOICE CLONING FUNCTIONS ==========

            // Load cloning interface
            loadCloningInterface: function() {
                // Reset UI to step 1
                document.getElementById('step1-content').style.display = 'block';
                document.getElementById('step2-content').style.display = 'none';
                document.getElementById('step3-content').style.display = 'none';
                document.getElementById('step4-content').style.display = 'none';
                
                // Reset step indicators
                document.getElementById('step1').className = 'recording-step active';
                document.getElementById('step2').className = 'recording-step';
                document.getElementById('step3').className = 'recording-step';
                document.getElementById('step4').className = 'recording-step';
                
                // Update voice status
                this.updateVoiceStatus();
            },

            // Start recording process
            startRecordingProcess: function() {
                // Update user name
                const newName = document.getElementById('userNameInput').value.trim();
                if (newName && newName !== this.state.user.name) {
                    this.state.user.name = newName;
                    this.updateUserInfo();
                }
                
                // Move to step 2
                document.getElementById('step1-content').style.display = 'none';
                document.getElementById('step2-content').style.display = 'block';
                
                // Update step indicators
                document.getElementById('step1').className = 'recording-step completed';
                document.getElementById('step2').className = 'recording-step active';
                
                // Reset recording state
                this.state.currentRecording = 0;
                this.state.recordings = [];
                this.state.cloneStatus = 'recording';
                this.saveState();
                
                // Load first recording phrase
                this.loadRecordingPhrase();
            },

            // Load recording phrase
            loadRecordingPhrase: function() {
                const phrase = this.cloningPhrases[this.state.currentRecording];
                const phraseWithName = phrase.replace('[Nome]', this.state.user.name);
                
                document.getElementById('recordingPhrase').textContent = phraseWithName;
                document.getElementById('currentRecordingNumber').textContent = this.state.currentRecording + 1;
                
                // Update progress
                const progress = (this.state.currentRecording / this.cloningPhrases.length) * 100;
                document.getElementById('recordingProgress').style.width = progress + '%';
                
                // Reset UI
                document.getElementById('recordingControls').style.display = 'none';
                document.getElementById('recordingStatus').textContent = 'Clique no microfone para começar';
                document.getElementById('recordButton').classList.remove('recording');
                document.getElementById('recordingTimer').style.display = 'none';
                document.getElementById('recordingCard').classList.remove('recording');
                
                // Update voice status
                this.updateVoiceStatus();
            },

            // Toggle recording
            toggleRecording: async function() {
                if (this.isRecording) {
                    this.stopRecording();
                } else {
                    await this.startRecording();
                }
            },

            // Start recording
            startRecording: async function() {
                try {
                    // Request microphone permission
                    this.audioStream = await navigator.mediaDevices.getUserMedia({ 
                        audio: {
                            echoCancellation: true,
                            noiseSuppression: true,
                            sampleRate: 44100
                        } 
                    });
                    
                    // Setup media recorder
                    this.mediaRecorder = new MediaRecorder(this.audioStream);
                    this.audioChunks = [];
                    
                    this.mediaRecorder.ondataavailable = (event) => {
                        this.audioChunks.push(event.data);
                    };
                    
                    this.mediaRecorder.onstop = () => {
                        const audioBlob = new Blob(this.audioChunks, { type: 'audio/webm' });
                        this.currentAudioUrl = URL.createObjectURL(audioBlob);
                        
                        // Enable playback and confirmation buttons
                        document.getElementById('recordingControls').style.display = 'block';
                        document.getElementById('replayBtn').disabled = false;
                        document.getElementById('confirmBtn').disabled = false;
                        document.getElementById('redoBtn').disabled = false;
                    };
                    
                    // Start recording
                    this.mediaRecorder.start();
                    this.isRecording = true;
                    
                    // Start timer
                    this.recordingStartTime = Date.now();
                    this.recordingTimer = setInterval(() => {
                        const elapsed = Math.floor((Date.now() - this.recordingStartTime) / 1000);
                        const minutes = Math.floor(elapsed / 60).toString().padStart(2, '0');
                        const seconds = (elapsed % 60).toString().padStart(2, '0');
                        document.getElementById('timerDisplay').textContent = `${minutes}:${seconds}`;
                    }, 1000);
                    
                    // Update UI
                    document.getElementById('recordButton').classList.add('recording');
                    document.getElementById('recordingStatus').textContent = 'Gravando... Clique para parar';
                    document.getElementById('recordingTimer').style.display = 'flex';
                    document.getElementById('recordingCard').classList.add('recording');
                    
                    this.showNotification('Gravação Iniciada', 'Fale a frase claramente...', 'info');
                    
                } catch (error) {
                    console.error('Error starting recording:', error);
                    this.showNotification('Erro de Microfone', 'Não foi possível acessar o microfone', 'error');
                }
            },

            // Stop recording
            stopRecording: function() {
                if (this.mediaRecorder && this.isRecording) {
                    this.mediaRecorder.stop();
                    this.isRecording = false;
                    
                    // Stop timer
                    if (this.recordingTimer) {
                        clearInterval(this.recordingTimer);
                        this.recordingTimer = null;
                    }
                    
                    // Stop audio stream
                    if (this.audioStream) {
                        this.audioStream.getTracks().forEach(track => track.stop());
                    }
                    
                    // Update UI
                    document.getElementById('recordButton').classList.remove('recording');
                    document.getElementById('recordingStatus').textContent = 'Gravação concluída';
                    document.getElementById('recordingTimer').style.display = 'none';
                    
                    this.showNotification('Gravação Concluída', 'Ouça sua gravação antes de confirmar', 'success');
                }
            },

            // Replay recording
            replayRecording: function() {
                if (this.currentAudioUrl) {
                    const audio = document.getElementById('playbackAudio');
                    audio.src = this.currentAudioUrl;
                    audio.play();
                }
            },

            // Confirm recording
            confirmRecording: function() {
                if (this.currentAudioUrl) {
                    // Save recording
                    this.state.recordings.push({
                        phrase: this.cloningPhrases[this.state.currentRecording],
                        audioUrl: this.currentAudioUrl,
                        timestamp: new Date().toISOString()
                    });
                    
                    this.state.user.recordings = this.state.recordings;
                    
                    // Move to next recording or process
                    this.state.currentRecording++;
                    
                    if (this.state.currentRecording < this.cloningPhrases.length) {
                        // More recordings to do
                        this.loadRecordingPhrase();
                        this.showNotification('Gravação Salva', `Progresso: ${this.state.currentRecording}/${this.cloningPhrases.length}`, 'success');
                    } else {
                        // All recordings complete - move to processing
                        this.state.recordingsComplete = true;
                        this.state.cloneStatus = 'processing';
                        this.startCloneProcessing();
                    }
                    
                    this.saveState();
                    this.updateVoiceStatus();
                }
            },

            // Redo recording
            redoRecording: function() {
                // Reset for current recording
                this.currentAudioUrl = null;
                document.getElementById('recordingControls').style.display = 'none';
                document.getElementById('recordingStatus').textContent = 'Clique no microfone para começar';
                document.getElementById('recordButton').classList.remove('recording');
                document.getElementById('recordingTimer').style.display = 'none';
                document.getElementById('recordingCard').classList.remove('recording');
            },

            // Start clone processing
            startCloneProcessing: function() {
                // Move to step 3
                document.getElementById('step2-content').style.display = 'none';
                document.getElementById('step3-content').style.display = 'block';
                
                // Update step indicators
                document.getElementById('step2').className = 'recording-step completed';
                document.getElementById('step3').className = 'recording-step active';
                
                // Start simulated processing
                this.simulateCloneProcessing();
            },

            // Simulate clone processing
            simulateCloneProcessing: function() {
                let progress = 10;
                const processingInterval = setInterval(() => {
                    progress += Math.random() * 15;
                    if (progress > 100) progress = 100;
                    
                    this.state.cloneProgress = Math.round(progress);
                    document.getElementById('processingProgress').style.width = progress + '%';
                    document.getElementById('processingPercent').textContent = Math.round(progress) + '%';
                    
                    // Update status messages
                    const statusMessages = [
                        'Analisando padrões vocais...',
                        'Processando timbre da voz...',
                        'Criando modelo de fala...',
                        'Otimizando para inglês...',
                        'Finalizando clone...'
                    ];
                    
                    const statusIndex = Math.floor(progress / 20);
                    if (statusIndex < statusMessages.length) {
                        document.getElementById('processingStatus').textContent = statusMessages[statusIndex];
                    }
                    
                    // When complete
                    if (progress >= 100) {
                        clearInterval(processingInterval);
                        setTimeout(() => {
                            this.completeCloneProcessing();
                        }, 1000);
                    }
                }, 800);
            },

            // Complete clone processing
            completeCloneProcessing: function() {
                // Generate clone ID
                this.state.user.voiceCloneId = 'clone_' + Date.now();
                this.state.user.voiceCloned = true;
                this.state.cloneStatus = 'ready';
                this.resembleConfig.voiceCloneId = this.state.user.voiceCloneId;
                
                // Move to step 4
                document.getElementById('step3-content').style.display = 'none';
                document.getElementById('step4-content').style.display = 'block';
                
                // Update step indicators
                document.getElementById('step3').className = 'recording-step completed';
                document.getElementById('step4').className = 'recording-step active';
                
                // Update clone info
                document.getElementById('cloneName').textContent = `Clone de ${this.state.user.name}`;
                document.getElementById('cloneId').textContent = this.state.user.voiceCloneId;
                document.getElementById('clonedCount').textContent = `${this.state.user.recordings.length}/5`;
                document.getElementById('cloneDate').textContent = new Date().toLocaleDateString('pt-BR');
                
                this.saveState();
                this.updateVoiceStatus();
                
                this.showNotification('Clone Criado!', 'Sua voz foi clonada com sucesso!', 'success');
            },

            // Test clone voice
            testCloneVoice: function() {
                if (!this.state.user.voiceCloned) {
                    this.showNotification('Voz Não Clonada', 'Clone sua voz primeiro', 'warning');
                    return;
                }
                
                const testPhrase = document.getElementById('testClonePhrase').textContent;
                this.speakWithClone(testPhrase);
            },

            // Test another phrase
            testAnotherPhrase: function() {
                const testPhrases = [
                    "Hello, this is my cloned voice speaking English",
                    "Learning English with my own voice is amazing",
                    "I can practice pronunciation every day",
                    "This technology helps me speak better",
                    "Thank you for this wonderful tool"
                ];
                
                const randomIndex = Math.floor(Math.random() * testPhrases.length);
                document.getElementById('testClonePhrase').textContent = testPhrases[randomIndex];
                
                this.testCloneVoice();
            },

            // Add more recordings
            addMoreRecordings: function() {
                // Reset to recording step
                this.state.currentRecording = this.state.user.recordings.length;
                this.state.cloneStatus = 'recording';
                
                // Go back to step 2
                document.getElementById('step4-content').style.display = 'none';
                document.getElementById('step2-content').style.display = 'block';
                
                // Update step indicators
                document.getElementById('step3').className = 'recording-step';
                document.getElementById('step4').className = 'recording-step';
                document.getElementById('step2').className = 'recording-step active';
                
                this.loadRecordingPhrase();
                this.updateVoiceStatus();
            },

            // Speak with clone (simulated - in real app would use Resemble.ai API)
            speakWithClone: function(text) {
                if ('speechSynthesis' in window) {
                    speechSynthesis.cancel();
                    
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'en-US';
                    utterance.rate = 0.9;
                    utterance.pitch = 1.0;
                    utterance.volume = 1.0;
                    
                    // Try to get a voice that sounds natural
                    const voices = speechSynthesis.getVoices();
                    if (voices.length > 0) {
                        // Try to find a Brazilian Portuguese accent for English
                        const preferredVoice = voices.find(voice => 
                            voice.lang.includes('pt') || voice.name.toLowerCase().includes('brazil')
                        ) || voices.find(voice => voice.lang.includes('en')) || voices[0];
                        
                        if (preferredVoice) {
                            utterance.voice = preferredVoice;
                        }
                    }
                    
                    speechSynthesis.speak(utterance);
                    
                    this.showNotification('Seu Clone Falando', 'Ouça sua voz clonada em inglês', 'info');
                    
                } else {
                    this.showNotification('Erro de Síntese', 'Seu navegador não suporta síntese de voz', 'error');
                }
            },

            // ========== LESSONS FUNCTIONS ==========

            // Load lesson
            loadLesson: function(index) {
                this.state.currentLesson = index;
                const lesson = this.state.lessons[index];
                
                const englishText = lesson.english.replace('[Name]', this.state.user.name);
                const portugueseText = lesson.portuguese.replace('[Name]', this.state.user.name);
                
                document.getElementById('lessonEnglish').textContent = englishText;
                document.getElementById('lessonPortuguese').textContent = portugueseText;
                document.getElementById('lessonTips').textContent = lesson.tips;
                document.getElementById('lessonProgress').textContent = `${index + 1}/${this.state.lessons.length}`;
                
                const difficultyClass = `badge badge-${lesson.difficulty}`;
                const difficultyText = lesson.difficulty === 'beginner' ? 'Iniciante' : 
                                      lesson.difficulty === 'intermediate' ? 'Intermediário' : 'Avançado';
                
                document.getElementById('lessonDifficultyBadge').className = difficultyClass;
                document.getElementById('lessonDifficultyBadge').textContent = difficultyText;
                document.getElementById('lessonCategoryTag').textContent = this.getCategoryName(lesson.category);
                
                document.getElementById('prevLessonBtn').disabled = index === 0;
                document.getElementById('nextLessonBtn').disabled = index === this.state.lessons.length - 1;
                document.getElementById('completeLessonBtn').disabled = lesson.completed;
                document.getElementById('completeLessonBtn').innerHTML = lesson.completed ? 
                    '<i class="fas fa-check-double"></i> Concluída' : 
                    '<i class="fas fa-check"></i> Concluir';
                
                document.getElementById('lessonNotes').value = lesson.notes || '';
                document.getElementById('lessonNotes').oninput = (e) => {
                    this.state.lessons[index].notes = e.target.value;
                    this.saveState();
                };
                
                this.renderLessonsList();
                
                document.getElementById('lessonAudioContainer').style.display = 'none';
                document.getElementById('audioLoading').style.display = 'none';
            },

            // Play lesson with clone voice
            playLessonWithClone: function() {
                const lesson = this.state.lessons[this.state.currentLesson];
                const text = lesson.english.replace('[Name]', this.state.user.name);
                
                if (!this.state.user.voiceCloned) {
                    this.showNotification('Voz Não Clonada', 'Clone sua voz primeiro na página de Clonar Voz', 'warning');
                    this.navigate('clone');
                    return;
                }
                
                document.getElementById('playLessonBtn').disabled = true;
                document.getElementById('playLessonBtn').innerHTML = '<i class="fas fa-spinner fa-spin"></i> Gerando...';
                document.getElementById('audioLoading').style.display = 'block';
                
                // Simulate API call delay
                setTimeout(() => {
                    this.speakWithClone(text);
                    
                    document.getElementById('playLessonBtn').disabled = false;
                    document.getElementById('playLessonBtn').innerHTML = '<i class="fas fa-user-circle"></i> Ouvir MINHA voz em Inglês';
                    document.getElementById('audioLoading').style.display = 'none';
                    document.getElementById('lessonAudioContainer').style.display = 'block';
                    
                    this.showNotification('Seu Clone em Ação', 'Ouça você mesmo falando inglês!', 'success');
                }, 1500);
            },

            completeLesson: function() {
                const index = this.state.currentLesson;
                if (!this.state.lessons[index].completed) {
                    this.state.lessons[index].completed = true;
                    if (!this.state.completedLessons.includes(index)) {
                        this.state.completedLessons.push(index);
                    }
                    
                    this.saveState();
                    this.loadLesson(index);
                    this.updateStats();
                    
                    this.showNotification('Parabéns!', 'Lição concluída com sucesso', 'success');
                    
                    if (index < this.state.lessons.length - 1) {
                        setTimeout(() => {
                            this.nextLesson();
                        }, 1000);
                    }
                }
            },

            prevLesson: function() {
                if (this.state.currentLesson > 0) {
                    this.loadLesson(this.state.currentLesson - 1);
                }
            },

            nextLesson: function() {
                if (this.state.currentLesson < this.state.lessons.length - 1) {
                    this.loadLesson(this.state.currentLesson + 1);
                } else {
                    this.showNotification('Parabéns!', 'Você completou todas as lições', 'success');
                }
            },

            // ========== PRACTICE FUNCTIONS ==========

            loadPracticePhrase: function() {
                const phrase = this.practicePhrases[this.state.currentPractice];
                document.getElementById('practicePhrase').textContent = phrase;
                document.getElementById('cloneReferencePhrase').textContent = phrase;
            },

            togglePracticeRecording: async function() {
                if (this.isRecording) {
                    this.stopPracticeRecording();
                } else {
                    await this.startPracticeRecording();
                }
            },

            startPracticeRecording: async function() {
                try {
                    this.audioStream = await navigator.mediaDevices.getUserMedia({ 
                        audio: {
                            echoCancellation: true,
                            noiseSuppression: true,
                            sampleRate: 44100
                        } 
                    });
                    
                    this.mediaRecorder = new MediaRecorder(this.audioStream);
                    this.audioChunks = [];
                    
                    this.mediaRecorder.ondataavailable = (event) => {
                        this.audioChunks.push(event.data);
                    };
                    
                    this.mediaRecorder.onstop = () => {
                        const audioBlob = new Blob(this.audioChunks, { type: 'audio/webm' });
                        const audioUrl = URL.createObjectURL(audioBlob);
                        document.getElementById('userRecording').src = audioUrl;
                    };
                    
                    this.mediaRecorder.start();
                    this.isRecording = true;
                    
                    document.getElementById('practiceRecordBtn').classList.add('recording');
                    document.getElementById('practiceStatus').textContent = 'Gravando... Clique para parar';
                    
                    this.showNotification('Gravação', 'Gravando sua pronúncia...', 'info');
                    
                } catch (error) {
                    console.error('Error starting recording:', error);
                    this.showNotification('Erro de Gravação', 'Não foi possível acessar o microfone', 'error');
                }
            },

            stopPracticeRecording: function() {
                if (this.mediaRecorder && this.isRecording) {
                    this.mediaRecorder.stop();
                    this.isRecording = false;
                    
                    if (this.audioStream) {
                        this.audioStream.getTracks().forEach(track => track.stop());
                    }
                    
                    document.getElementById('practiceRecordBtn').classList.remove('recording');
                    document.getElementById('practiceStatus').textContent = 'Gravação concluída';
                    document.getElementById('practicePreview').style.display = 'block';
                    
                    this.showNotification('Gravação', 'Gravação concluída com sucesso', 'success');
                }
            },

            redoPractice: function() {
                document.getElementById('practicePreview').style.display = 'none';
                document.getElementById('practiceStatus').textContent = 'Clique para gravar';
            },

            playCloneReference: function() {
                const phrase = this.practicePhrases[this.state.currentPractice];
                
                if (!this.state.user.voiceCloned) {
                    this.showNotification('Voz Não Clonada', 'Clone sua voz primeiro', 'warning');
                    this.navigate('clone');
                    return;
                }
                
                const playBtn = document.getElementById('playCloneBtn');
                const loadingDiv = document.getElementById('cloneLoading');
                
                playBtn.disabled = true;
                playBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Gerando...';
                loadingDiv.style.display = 'block';
                
                setTimeout(() => {
                    this.speakWithClone(phrase);
                    
                    playBtn.disabled = false;
                    playBtn.innerHTML = '<i class="fas fa-user-circle"></i> Ouvir MEU Clone';
                    loadingDiv.style.display = 'none';
                    document.getElementById('cloneAudio').style.display = 'block';
                    
                    this.showNotification('Referência', 'Ouça seu clone como referência', 'success');
                }, 1000);
            },

            compareWithClone: function() {
                if (!this.state.user.voiceCloned) {
                    this.showNotification('Voz Não Clonada', 'Clone sua voz primeiro', 'warning');
                    return;
                }
                
                const compareBtn = document.getElementById('compareBtn');
                compareBtn.disabled = true;
                compareBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Comparando...';
                
                setTimeout(() => {
                    const similarity = Math.floor(Math.random() * 30) + 70;
                    
                    document.getElementById('similarityScore').textContent = similarity + '%';
                    document.getElementById('similarityBar').style.width = similarity + '%';
                    
                    let feedback = '';
                    if (similarity >= 90) feedback = 'Excelente! Sua pronúncia é muito parecida com seu clone.';
                    else if (similarity >= 80) feedback = 'Muito bom! Continue praticando para ficar ainda mais parecido.';
                    else if (similarity >= 70) feedback = 'Bom! Sua pronúncia está ficando parecida com seu clone.';
                    else feedback = 'Continue praticando! Ouça seu clone com atenção e tente imitar.';
                    
                    document.getElementById('cloneFeedback').textContent = feedback;
                    document.getElementById('comparisonResult').style.display = 'block';
                    
                    compareBtn.disabled = false;
                    compareBtn.innerHTML = '<i class="fas fa-user-circle"></i> Comparar com Meu Clone';
                    
                    this.showNotification('Comparação Concluída', `Similaridade: ${similarity}% com seu clone`, 'success');
                }, 2000);
            },

            nextPracticePhrase: function() {
                this.state.currentPractice = (this.state.currentPractice + 1) % this.practicePhrases.length;
                this.loadPracticePhrase();
                document.getElementById('practicePreview').style.display = 'none';
                document.getElementById('comparisonResult').style.display = 'none';
                document.getElementById('cloneAudio').style.display = 'none';
                document.getElementById('practiceStatus').textContent = 'Clique para gravar';
            },

            // ========== ADMIN FUNCTIONS ==========

            showAdminSection: function(section) {
                document.querySelectorAll('.admin-section').forEach(s => s.style.display = 'none');
                document.querySelectorAll('.admin-nav a').forEach(a => a.classList.remove('active'));
                
                const sectionId = 'admin' + section.charAt(0).toUpperCase() + section.slice(1);
                document.getElementById(sectionId).style.display = 'block';
                
                document.querySelectorAll('.admin-nav a').forEach(a => {
                    if (a.textContent.includes(this.getAdminSectionName(section))) {
                        a.classList.add('active');
                    }
                });
                
                switch(section) {
                    case 'cloneManagement':
                        this.renderClonesList();
                        break;
                    case 'lessons':
                        this.renderAdminLessons();
                        break;
                    case 'dashboard':
                        this.updateAdminStats();
                        break;
                }
            },

            getAdminSectionName: function(section) {
                const sections = {
                    'dashboard': 'Dashboard',
                    'cloneManagement': 'Gerenciar Clones',
                    'lessons': 'Lições',
                    'create': 'Nova Lição'
                };
                return sections[section] || section;
            },

            // ========== UTILITY FUNCTIONS ==========

            renderLessonsList: function() {
                const list = document.getElementById('lessonsList');
                list.innerHTML = '';
                
                this.state.lessons.forEach((lesson, index) => {
                    const li = document.createElement('li');
                    li.className = 'lesson-item';
                    if (index === this.state.currentLesson) {
                        li.classList.add('active');
                    }
                    
                    const difficultyClass = `badge badge-${lesson.difficulty}`;
                    const difficultyText = lesson.difficulty === 'beginner' ? 'Iniciante' : 
                                          lesson.difficulty === 'intermediate' ? 'Intermediário' : 'Avançado';
                    
                    li.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: ${index === this.state.currentLesson ? 'bold' : 'normal'}; margin-bottom: 5px;">
                                    ${lesson.title}
                                </div>
                                <div style="font-size: 0.85rem; color: var(--gray);">
                                    <span class="${difficultyClass}">${difficultyText}</span>
                                    <span class="category-tag">${this.getCategoryName(lesson.category)}</span>
                                </div>
                            </div>
                            ${lesson.completed ? '<i class="fas fa-check-circle" style="color: var(--success);"></i>' : ''}
                        </div>
                    `;
                    
                    li.onclick = () => {
                        this.loadLesson(index);
                    };
                    
                    list.appendChild(li);
                });
                
                this.updateProgress();
            },

            updateProgress: function() {
                const completed = this.state.lessons.filter(l => l.completed).length;
                const total = this.state.lessons.length;
                const progress = Math.round((completed / total) * 100);
                
                document.getElementById('sidebarProgress').style.width = progress + '%';
                document.getElementById('progressPercentText').textContent = progress + '% concluído';
                document.getElementById('completedCount').textContent = `${completed}/${total}`;
            },

            updateStats: function() {
                const completed = this.state.lessons.filter(l => l.completed).length;
                const total = this.state.lessons.length;
                const progress = Math.round((completed / total) * 100);
                
                document.getElementById('totalLessons').textContent = total;
                document.getElementById('completedLessons').textContent = completed;
                document.getElementById('progressPercent').textContent = progress + '%';
            },

            updateAdminStats: function() {
                document.getElementById('adminLessonCount').textContent = this.state.lessons.length;
                document.getElementById('adminCloneCount').textContent = this.state.user.voiceCloned ? '1' : '0';
                document.getElementById('adminRecordingCount').textContent = this.state.user.recordings.length;
                document.getElementById('activeClonesCount').textContent = this.state.user.voiceCloned ? '1' : '0';
                
                const completed = this.state.lessons.filter(l => l.completed).length;
                const total = this.state.lessons.length;
                const progress = Math.round((completed / total) * 100);
                document.getElementById('adminProgress').textContent = progress + '%';
            },

            renderAdminLessons: function() {
                const container = document.getElementById('lessonsManagement');
                if (!container) return;
                
                container.innerHTML = '';
                
                if (this.state.lessons.length === 0) {
                    container.innerHTML = '<p style="color: var(--gray); text-align: center; padding: 40px;">Nenhuma lição criada ainda.</p>';
                    return;
                }
                
                this.state.lessons.forEach((lesson, index) => {
                    const div = document.createElement('div');
                    div.className = 'lesson-item';
                    div.style.cursor = 'default';
                    
                    const difficultyClass = `badge badge-${lesson.difficulty}`;
                    const difficultyText = lesson.difficulty === 'beginner' ? 'Iniciante' : 
                                          lesson.difficulty === 'intermediate' ? 'Intermediário' : 'Avançado';
                    
                    div.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="flex: 1;">
                                <div style="font-weight: bold; margin-bottom: 5px;">${lesson.title}</div>
                                <div style="color: var(--gray); margin-bottom: 5px;">${lesson.english}</div>
                                <div>
                                    <span class="${difficultyClass}">${difficultyText}</span>
                                    <span class="category-tag">${this.getCategoryName(lesson.category)}</span>
                                    ${lesson.completed ? 
                                        '<span style="color: var(--success); font-size: 0.9rem; margin-left: 10px;"><i class="fas fa-check-circle"></i> Concluída</span>' : 
                                        '<span style="color: var(--gray); font-size: 0.9rem; margin-left: 10px;"><i class="fas fa-clock"></i> Pendente</span>'}
                                </div>
                            </div>
                            <div class="btn-group">
                                <button class="btn btn-secondary" onclick="VoiceLearn.editLesson(${index})" style="padding: 5px 10px;">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-danger" onclick="VoiceLearn.deleteLesson(${index})" style="padding: 5px 10px;">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `;
                    
                    container.appendChild(div);
                });
            },

            renderClonesList: function() {
                const container = document.getElementById('clonesList');
                if (!container) return;
                
                container.innerHTML = '';
                
                if (!this.state.user.voiceCloned) {
                    container.innerHTML = '<p style="color: var(--gray); text-align: center; padding: 40px;">Nenhum clone de voz criado ainda.</p>';
                    return;
                }
                
                const div = document.createElement('div');
                div.className = 'lesson-item';
                div.style.cursor = 'default';
                
                div.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="flex: 1;">
                            <div style="font-weight: bold; margin-bottom: 5px; display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-user-circle" style="color: var(--primary);"></i>
                                Clone de ${this.state.user.name}
                            </div>
                            <div style="color: var(--gray); margin-bottom: 5px;">
                                <div><strong>ID:</strong> <code>${this.state.user.voiceCloneId}</code></div>
                                <div><strong>Gravações:</strong> ${this.state.user.recordings.length} frases</div>
                                <div><strong>Criado em:</strong> ${new Date().toLocaleDateString('pt-BR')}</div>
                            </div>
                            <div>
                                <span class="clone-status ready" style="padding: 4px 10px; display: inline-block;">
                                    <i class="fas fa-check-circle"></i> Ativo
                                </span>
                            </div>
                        </div>
                        <div class="btn-group">
                            <button class="btn btn-primary" onclick="VoiceLearn.testCloneAPI()" style="padding: 5px 10px;">
                                <i class="fas fa-volume-up"></i> Testar
                            </button>
                            <button class="btn btn-danger" onclick="VoiceLearn.deleteClone()" style="padding: 5px 10px;">
                                <i class="fas fa-trash"></i> Excluir
                            </button>
                        </div>
                    </div>
                `;
                
                container.appendChild(div);
            },

            getCategoryName: function(category) {
                const categories = {
                    'greetings': 'Saudações',
                    'restaurant': 'Restaurante',
                    'travel': 'Viagens',
                    'shopping': 'Compras',
                    'work': 'Trabalho',
                    'personal': 'Pessoal',
                    'requests': 'Pedidos'
                };
                return categories[category] || category;
            },

            // Notification System
            showNotification: function(title, message, type = 'info') {
                const notification = document.getElementById('notification');
                const icon = document.getElementById('notification-icon');
                const notifTitle = document.getElementById('notification-title');
                const notifMessage = document.getElementById('notification-message');
                
                switch(type) {
                    case 'success':
                        icon.className = 'fas fa-check-circle';
                        notification.className = 'notification success show';
                        break;
                    case 'error':
                        icon.className = 'fas fa-exclamation-circle';
                        notification.className = 'notification error show';
                        break;
                    case 'warning':
                        icon.className = 'fas fa-exclamation-triangle';
                        notification.className = 'notification warning show';
                        break;
                    default:
                        icon.className = 'fas fa-info-circle';
                        notification.className = 'notification show';
                }
                
                notifTitle.textContent = title;
                notifMessage.textContent = message;
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 5000);
            },

            hideNotification: function() {
                document.getElementById('notification').classList.remove('show');
            }
        };

        // Initialize application when page loads
        document.addEventListener('DOMContentLoaded', function() {
            VoiceLearn.init();
            
            // Add keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key) {
                        case 'ArrowLeft':
                            VoiceLearn.prevLesson();
                            break;
                        case 'ArrowRight':
                            VoiceLearn.nextLesson();
                            break;
                        case ' ':
                            e.preventDefault();
                            const activePage = document.querySelector('.page.active').id;
                            if (activePage === 'lessons-page') {
                                VoiceLearn.playLessonWithClone();
                            }
                            break;
                    }
                }
            });
            
            // Request microphone permission
            if ('mediaDevices' in navigator && 'getUserMedia' in navigator.mediaDevices) {
                navigator.mediaDevices.enumerateDevices()
                    .then(devices => {
                        console.log('Audio devices available:', devices);
                    })
                    .catch(err => {
                        console.warn('Cannot enumerate devices:', err);
                    });
            }
        });
    </script>
</body>
</html>
